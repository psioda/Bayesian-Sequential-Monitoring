beta(a.e.2+y1,b.e.2+y0)/beta(a.e.2,b.e.2))
k.1<-k.0*c/(sum(k.0*c))
result<-k.1[1]*(a.s.1+y1)/(a.s.1+b.s.1+y1+y0)+
k.1[2]*(a.s.2+y1)/(a.s.2+b.s.2+y1+y0)+
k.1[3]*(a.e.1+y1)/(a.e.1+b.e.1+y1+y0)+
k.1[4]*(a.e.2+y1)/(a.e.2+b.e.2+y1+y0)
return(result)}
## Design parameters, usual case ##
p.skpt<-0.20      # response rate for skeptic, enthusiast, futility
p.enth<-0.40
p.intr<-0.30
tail.skpt<-0.045  # tail probabilities for priors (low, high)
tail.enth<-0.05
sig.fut<-0.85     # significant trial result threshold
sig.eff<-0.95
cred.tail<-0.05   # credible interval is 1-cred.tail
max.ss<-76        # maximum sample size
## Design parameters, usual case ##
p.skpt<-0.20      # response rate for skeptic, enthusiast, futility
p.enth<-0.40
p.intr<-0.30
tail.skpt<-0.045  # tail probabilities for priors (low, high)
tail.enth<-0.05
sig.fut<-0.85     # significant trial result threshold
sig.eff<-0.95
cred.tail<-0.05   # credible interval is 1-cred.tail
max.ss<-76        # maximum sample size
# Step 1: Create grid for possible values of phi
phi.range<-seq(0,100,by=0.001)
# Step 2: Compute tail probabilities for every possible choice of phi
# upper tail probability equal to tail.skpt
quantiles.skpt<-qbeta(tail.skpt,(p.skpt)*phi.range,(1-(p.skpt))*phi.range,
lower.tail=FALSE)
# lower tail probability equal to tail.enth
quantiles.enth<-qbeta(tail.enth,(p.enth)*phi.range,(1-(p.enth))*phi.range,
lower.tail=TRUE)
# Step 3: Grid search to find value of phi with the desired tail probability for the priors
phi_L<-phi.range[which.min(abs(p.enth-quantiles.skpt))] # fixed 5/13/19
phi_H<-phi.range[which.min(abs(p.skpt-quantiles.enth))] # fixed 5/13/19
# Step 4: Find parameters for the priors
alpha.skpt<-(p.skpt)*phi_L
beta.skpt<-(1-(p.skpt))*phi_L
alpha.enth<-(p.enth)*phi_H
beta.enth<-(1-(p.enth))*phi_H
spike<-0 # spike/slab version or regular version
## Design parameters, usual case ##
p.skpt<-0.20      # response rate for skeptic, enthusiast, futility
p.enth<-0.40
p.intr<-0.30
tail.skpt<-0.045  # tail probabilities for priors (low, high)
tail.enth<-0.05
sig.fut<-0.85     # significant trial result threshold
sig.eff<-0.95
cred.tail<-0.05   # credible interval is 1-cred.tail
max.ss<-76        # maximum sample size
## Simulation parameters ##
reps<-20000       # number of simulated trials per design
p.range<-seq(p.skpt-0.05,p.enth+0.05,by=0.05) # range of response proportion
#p.range<-0.2
freq.mntr<-2      # frequency of monitoring
#freq.mntr<-c(1,2,4,8,16,76)
#freq.mntr<-rep(c(1,2,4,8,16,80),4)
enr.shape<-1      # shape gamma dist enrollment
#enr.shape<-c(rep(1,12),rep(0.25,12))
#enr.shape<-rep(1,6)
out.mean<-4       # mean normal dist outcome
#out.mean<-rep(4,6)
#out.mean<-rep(c(rep(4,6),rep(8,6)),2)
#################################################################################################
## SIMULATIONS ##################################################################################
#################################################################################################
matrix.names<-c("eff.mon.initial","eff.mon.final",
"eff.inf.initial","eff.inf.final",
"fut.mon.initial","fut.mon.final",
"fut.inf.initial","fut.inf.final",
"phat.initial","phat.final",
"ss.initial","ss.final",
"post.mean.initial","post.mean.final",
"cov.initial","cov.final")
outer<- array(NA,dim = c(length(freq.mntr),length(p.range),length(matrix.names)),
dimnames = list(seq_len(length(freq.mntr)),p.range,matrix.names))
inner <- array(NA, dim=c(reps,length(matrix.names)), dimnames = list(seq_len(reps),matrix.names))
## posterior probability
probs.p<-c(0,0.01,0.1,0.25,0.5,0.75,0.9,0.99,1)
outer.p <- array(NA,dim=c(length(freq.mntr),length(p.range),length(probs.p)),
dimnames= list(seq_len(length(freq.mntr)),p.range,probs.p))
inner.p <- array(NA, dim=c(reps,2),dimnames=list(seq_len(reps),c("initial.p","final.p")))
outer.p.agree<-array(NA,dim=c(length(freq.mntr),length(p.range),3),
dimnames= list(seq_len(length(freq.mntr)),p.range,c("p.agree","efficacy","conditional")))
for (i in 1:length(freq.mntr)){
for (j in 1:length(p.range)){
for (k in 1:reps){
if (k%%1000==0){print(paste0("Model ",i,", Response p=",p.range[j],", Simulation ",k))}
enr.times<-cumsum(rgamma(n=max.ss,shape=enr.shape[i],scale=0.5))
outcome.times<-sort(enr.times+rnorm(n=max.ss,mean=out.mean[i],sd=0.25))
responses<-rbinom(n=max.ss,size=1,prob=p.range[j])
y1<-cumsum(responses)
y0<-seq(1:length(responses))-y1
## monitoring
if (spike==0){
futility<-pbeta(p.intr,alpha.enth+y1,beta.enth+y0,lower.tail=TRUE)
efficacy<-pbeta(p.skpt,alpha.skpt+y1,beta.skpt+y0,lower.tail=TRUE)}
if (spike==1){
futility<-posterior.cdf(a1=alpha.enth.1,b1=beta.enth.1,
a2=alpha.enth.2,b2=beta.enth.2,
y0=y0,y1=y1,q=p.intr)
efficacy<-posterior.cdf(a1=alpha.skpt.1,b1=beta.skpt.1,
a2=alpha.skpt.2,b2=beta.skpt.2,
y0=y0,y1=y1,q=p.skpt)}
n.initial<-min(
which((futility>sig.fut) | ((1-efficacy)>sig.eff) & (seq(1:max.ss)%%freq.mntr==0)),
max.ss,na.rm=TRUE)
cutoff.time<-outcome.times[n.initial]
n.final<-length(responses[enr.times<=cutoff.time])
time<-c("initial","final")
n<-c(n.initial,n.final)
for (l in 1:2){
inner[k,paste0("fut.mon.",time[l])]<-(futility[n[l]]>sig.fut)
inner[k,paste0("eff.mon.",time[l])]<-(1-efficacy[n[l]]>sig.eff)
inner[k,paste0("ss.",time[l])]<-n[l]
inner[k,paste0("phat.",time[l])]<-y1[n[l]]/n[l]
if (spike==0){
inner[k,paste0("fut.inf.",time[l])]<-(posterior.cdf(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y0=y0[n[l]],y1=y1[n[l]],q=p.intr)>sig.fut)
inner[k,paste0("eff.inf.",time[l])]<-(1-posterior.cdf(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y0=y0[n[l]],y1=y1[n[l]],q=p.skpt)>sig.eff)
inner[k,paste0("post.mean.",time[l])]<-posterior.mean(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y1=y1[n[l]],y0=y0[n[l]])
inner[k,paste0("cov.",time[l])]<-posterior.cov(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y1=y1[n[l]],y0=y0[n[l]],
p=p.range[j],
cred.tail=cred.tail)}
if (spike==1){
inner[k,paste0("fut.inf.",time[l])]<-(posterior.cdf.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,
w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,
w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]],q=p.intr)>sig.fut)
inner[k,paste0("eff.inf.",time[l])]<-(1-posterior.cdf.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,
w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,
w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]],q=p.skpt)>sig.eff)
inner[k,paste0("post.mean.",time[l])]<-posterior.mean.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]])
inner[k,paste0("cov.",time[l])]<-posterior.cov.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]],p=p.range[j],cred.tail=cred.tail)}
# posterior probability
inner.p[k,paste0(time[l],".p")]<-(1-efficacy[n[l]])
}
}
outer[i,j,]<-apply(inner,MARGIN=2,FUN=mean)
outer.p[i,j,]<-quantile(inner.p[,"final.p"][inner.p[,"initial.p"]>sig.eff],probs=probs.p)
outer.p.agree[i,j,"p.agree"]<-sum((inner.p[,"initial.p"]>sig.eff)==(inner.p[,"final.p"]>sig.eff))/reps
outer.p.agree[i,j,"efficacy"]<-sum((inner.p[,"initial.p"]>sig.eff) & (inner.p[,"final.p"]>sig.eff))/reps
outer.p.agree[i,j,"conditional"]<-sum((inner.p[,"initial.p"]>sig.eff) & (inner.p[,"final.p"]>sig.eff))/
sum(inner.p[,"initial.p"]>sig.eff)
}
}
spike<-0 # spike/slab version or regular version
## Design parameters, usual case ##
p.skpt<-0.20      # response rate for skeptic, enthusiast, futility
p.enth<-0.40
p.intr<-0.30
tail.skpt<-0.045  # tail probabilities for priors (low, high)
tail.enth<-0.05
sig.fut<-0.85     # significant trial result threshold
sig.eff<-0.95
cred.tail<-0.05   # credible interval is 1-cred.tail
max.ss<-76        # maximum sample size
## Simulation parameters ##
reps<-10000       # number of simulated trials per design
p.range<-seq(p.skpt-0.05,p.enth+0.05,by=0.05) # range of response proportion
#p.range<-0.2
freq.mntr<-2      # frequency of monitoring
#freq.mntr<-c(1,2,4,8,16,76)
#freq.mntr<-rep(c(1,2,4,8,16,80),4)
enr.shape<-1      # shape gamma dist enrollment
#enr.shape<-c(rep(1,12),rep(0.25,12))
#enr.shape<-rep(1,6)
out.mean<-4       # mean normal dist outcome
#out.mean<-rep(4,6)
#out.mean<-rep(c(rep(4,6),rep(8,6)),2)
#################################################################################################
## SIMULATIONS ##################################################################################
#################################################################################################
matrix.names<-c("eff.mon.initial","eff.mon.final",
"eff.inf.initial","eff.inf.final",
"fut.mon.initial","fut.mon.final",
"fut.inf.initial","fut.inf.final",
"phat.initial","phat.final",
"ss.initial","ss.final",
"post.mean.initial","post.mean.final",
"cov.initial","cov.final")
outer<- array(NA,dim = c(length(freq.mntr),length(p.range),length(matrix.names)),
dimnames = list(seq_len(length(freq.mntr)),p.range,matrix.names))
inner <- array(NA, dim=c(reps,length(matrix.names)), dimnames = list(seq_len(reps),matrix.names))
## posterior probability
probs.p<-c(0,0.01,0.1,0.25,0.5,0.75,0.9,0.99,1)
outer.p <- array(NA,dim=c(length(freq.mntr),length(p.range),length(probs.p)),
dimnames= list(seq_len(length(freq.mntr)),p.range,probs.p))
inner.p <- array(NA, dim=c(reps,2),dimnames=list(seq_len(reps),c("initial.p","final.p")))
outer.p.agree<-array(NA,dim=c(length(freq.mntr),length(p.range),3),
dimnames= list(seq_len(length(freq.mntr)),p.range,c("p.agree","efficacy","conditional")))
for (i in 1:length(freq.mntr)){
for (j in 1:length(p.range)){
for (k in 1:reps){
if (k%%1000==0){print(paste0("Model ",i,", Response p=",p.range[j],", Simulation ",k))}
enr.times<-cumsum(rgamma(n=max.ss,shape=enr.shape[i],scale=0.5))
outcome.times<-sort(enr.times+rnorm(n=max.ss,mean=out.mean[i],sd=0.25))
responses<-rbinom(n=max.ss,size=1,prob=p.range[j])
y1<-cumsum(responses)
y0<-seq(1:length(responses))-y1
## monitoring
if (spike==0){
futility<-pbeta(p.intr,alpha.enth+y1,beta.enth+y0,lower.tail=TRUE)
efficacy<-pbeta(p.skpt,alpha.skpt+y1,beta.skpt+y0,lower.tail=TRUE)}
if (spike==1){
futility<-posterior.cdf(a1=alpha.enth.1,b1=beta.enth.1,
a2=alpha.enth.2,b2=beta.enth.2,
y0=y0,y1=y1,q=p.intr)
efficacy<-posterior.cdf(a1=alpha.skpt.1,b1=beta.skpt.1,
a2=alpha.skpt.2,b2=beta.skpt.2,
y0=y0,y1=y1,q=p.skpt)}
n.initial<-min(
which((futility>sig.fut) | ((1-efficacy)>sig.eff) & (seq(1:max.ss)%%freq.mntr==0)),
max.ss,na.rm=TRUE)
cutoff.time<-outcome.times[n.initial]
n.final<-length(responses[enr.times<=cutoff.time])
time<-c("initial","final")
n<-c(n.initial,n.final)
for (l in 1:2){
inner[k,paste0("fut.mon.",time[l])]<-(futility[n[l]]>sig.fut)
inner[k,paste0("eff.mon.",time[l])]<-(1-efficacy[n[l]]>sig.eff)
inner[k,paste0("ss.",time[l])]<-n[l]
inner[k,paste0("phat.",time[l])]<-y1[n[l]]/n[l]
if (spike==0){
inner[k,paste0("fut.inf.",time[l])]<-(posterior.cdf(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y0=y0[n[l]],y1=y1[n[l]],q=p.intr)>sig.fut)
inner[k,paste0("eff.inf.",time[l])]<-(1-posterior.cdf(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y0=y0[n[l]],y1=y1[n[l]],q=p.skpt)>sig.eff)
inner[k,paste0("post.mean.",time[l])]<-posterior.mean(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y1=y1[n[l]],y0=y0[n[l]])
inner[k,paste0("cov.",time[l])]<-posterior.cov(a1=alpha.skpt,b1=beta.skpt,
a2=alpha.enth,b2=beta.enth,
y1=y1[n[l]],y0=y0[n[l]],
p=p.range[j],
cred.tail=cred.tail)}
if (spike==1){
inner[k,paste0("fut.inf.",time[l])]<-(posterior.cdf.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,
w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,
w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]],q=p.intr)>sig.fut)
inner[k,paste0("eff.inf.",time[l])]<-(1-posterior.cdf.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,
w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,
w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]],q=p.skpt)>sig.eff)
inner[k,paste0("post.mean.",time[l])]<-posterior.mean.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]])
inner[k,paste0("cov.",time[l])]<-posterior.cov.2(
a.s.1=alpha.skpt.1,b.s.1=beta.skpt.1,
a.s.2=alpha.skpt.2,b.s.2=beta.skpt.2,w.s.1=mix.1,
a.e.1=alpha.enth.1,b.e.1=beta.enth.1,
a.e.2=alpha.enth.2,b.e.2=beta.enth.2,w.e.1=mix.2,
y1=y1[n[l]],y0=y0[n[l]],p=p.range[j],cred.tail=cred.tail)}
# posterior probability
inner.p[k,paste0(time[l],".p")]<-(1-efficacy[n[l]])
}
}
outer[i,j,]<-apply(inner,MARGIN=2,FUN=mean)
outer.p[i,j,]<-quantile(inner.p[,"final.p"][inner.p[,"initial.p"]>sig.eff],probs=probs.p)
outer.p.agree[i,j,"p.agree"]<-sum((inner.p[,"initial.p"]>sig.eff)==(inner.p[,"final.p"]>sig.eff))/reps
outer.p.agree[i,j,"efficacy"]<-sum((inner.p[,"initial.p"]>sig.eff) & (inner.p[,"final.p"]>sig.eff))/reps
outer.p.agree[i,j,"conditional"]<-sum((inner.p[,"initial.p"]>sig.eff) & (inner.p[,"final.p"]>sig.eff))/
sum(inner.p[,"initial.p"]>sig.eff)
}
}
par(mfrow = c(1,1))
par(mar=c(5.1+5,4.1,4.1,2.1))
i<-1
plot(p.range,outer[i,,"eff.mon.initial"],type='l',ylim=c(0,1),lwd=2,col="blue",
ylab="Probability",xlab="",
main="Sequential Design Properties",
axes=FALSE)
box()
#text(p.range,outer[i,,"eff.mon.initial"],labels=format(round(outer[i,,"eff.mon.initial"],digits=2),nsmall=2),pos=3)
#lines(p.range,outer[i,,"fut.mon.final"],lwd=2)
lines(p.range,outer[i,,"fut.mon.initial"],lwd=2,col="red")
#text(p.range,outer[i,,"fut.mon.initial"],labels=format(round(outer[i,,"fut.mon.initial"],digits=2),nsmall=2),pos=1)
#lines(p.range,outer[i,,"eff.mon.final"],lwd=2)
## calculate futility
lines(p.range,1-outer[i,,"fut.mon.initial"]-outer[i,,"eff.mon.initial"],lwd=2,col="darkgrey")
#lines(p.range,outer[i,,"inc.final"],lwd=2)
#text(p.range,outer[i,,"inc"],
#     labels=format(round(outer[i,,"inc"],digits=2),nsmall=2),pos=1)
axis(1,las=0,at=p.range,labels=format(p.range,nsmall=2))
axis(2,las=2,at=seq(0,1,by=0.1),labels=format(seq(0,1,by=0.1),nsmall=1))
abline(h=seq(0,1,by=0.1),col='grey')
abline(v=c(p.skpt,p.enth),col='grey',lty='dashed')
legend("right",text.width=0.05,seg.len=0.2,
inset = c(0, -0.2), bty = "n", x.intersp=0.5,
xjust=0, yjust=0,
legend=c("Stop Early for Efficacy","Stop Early for Futility","Inconclusive Findings w/ Full Dataset"),
col=c("blue","red","darkgrey"),
lwd=3, cex = 0.75, xpd = TRUE)
row<-2
for (j in 1:length(p.range)){
mtext(text=paste0(format(round(outer[i,j,"eff.mon.initial"]*100,digits=1),nsmall=1),"%"),
side=1,line=row+1,at=p.range[j])
}
mtext(text="EFF",side=1,line=row+1,at=0.125)
row<-3
for (j in 1:length(p.range)){
mtext(text=paste0(format(round(outer[i,j,"fut.mon.initial"]*100,digits=1),nsmall=1),"%"),
side=1,line=row+1,at=p.range[j])
}
mtext(text="FUT",side=1,line=row+1,at=0.125)
row<-4
for (j in 1:length(p.range)){
mtext(text=paste0(format(round((1-outer[i,j,"fut.mon.initial"]-outer[i,j,"eff.mon.initial"])*100,digits=1),
nsmall=1),"%"),
side=1,line=row+1,at=p.range[j])
}
mtext(text="INC",side=1,line=row+1,at=0.125)
row<-6
for (j in 1:length(p.range)){
mtext(text=paste0(format(round(outer[i,j,"ss.initial"],digits=1),nsmall=1),
" + ",
format(round(outer[i,j,"ss.final"]-
outer[i,j,"ss.initial"],digits=1),nsmall=1),
" = ",
format(round(outer[i,j,"ss.final"],digits=1),nsmall=1)),
side=1,line=row+1,at=p.range[j])
}
mtext(text="CP",side=1,line=row+1,at=0.125)
row<-7
for (j in 1:length(p.range)){
mtext(text=paste0("(I) ",
format(round(outer[i,j,"post.mean.initial"],digits=3),nsmall=3),
" (F) ",
format(round(outer[i,j,"post.mean.final"],digits=3),nsmall=3)),
side=1,line=row+1,at=p.range[j])
}
mtext(text="SS",side=1,line=row+1,at=0.125)
row<-8
for (j in 1:length(p.range)){
mtext(text=paste0("(I) ",
format(round(outer[i,j,"cov.initial"],digits=3),nsmall=3),
" (F) ",
format(round(outer[i,j,"cov.final"],digits=3),nsmall=3)),
side=1,line=row+1,at=p.range[j])
}
mtext(text="PM",side=1,line=row+1,at=0.125)
# column<-1
# text(locator(1),"Stop Early for Efficacy")
# text(locator(1),"Final Efficacy")
# text(locator(1),"Stop Early for Futility")
# text(locator(1),"Final Futility")
# text(locator(1),"Inconclusive")
# text(locator(1),"Final Inconclusive")
# legend(x=0.325,y=0.6,
#        legend=c("Stop Early for Efficacy",
#                 "Stop Early for Futility",
#                 "Inconclusive with Full Data"),
#        lty=c('longdash','dotted','solid'),
#        cex=0.5,
#        box.lwd = 1,box.col = "black",bg = "white",pt.cex = 1,
#        text.width=20)
rm(list = ls())
## Design parameters, spike/slab case ##
alpha.skpt.1<-0.969595
beta.skpt.1<-2.186593
alpha.skpt.2<-10.199189
beta.skpt.2<-46.344410
mix.1<-0.1421888
par(mfrow = c(1, 1))
x<-seq(0,1,by=0.01)
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,
max(mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2))))
y<-mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2)
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,15))
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,15))
polygon(c(x[x<=0.4],0.4),c(y[x<=0.4],0),col="blue")
polygon(c(x[x>=0.4],0.4),c(y[x>=0.4],0),col="red")
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,10))
y<-mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2)
polygon(c(x[x<=0.4],0.4),c(y[x<=0.4],0),col="blue")
polygon(c(x[x>=0.4],0.4),c(y[x>=0.4],0),col="red")
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,8))
y<-mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2)
polygon(c(x[x<=0.4],0.4),c(y[x<=0.4],0),col="blue")
polygon(c(x[x>=0.4],0.4),c(y[x>=0.4],0),col="red")
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,8))
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,8))
plot(x,mix.2*dbeta(x,alpha.enth.1,beta.enth.1)+(1-mix.2)*dbeta(x,alpha.enth.2,beta.enth.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Enthuastic Prior",
ylim=c(0,8))
## Design parameters, spike/slab case ##
alpha.skpt.1<-0.969595
beta.skpt.1<-2.186593
alpha.skpt.2<-10.199189
beta.skpt.2<-46.344410
mix.1<-0.1421888
alpha.enth.1<-2.460314
beta.enth.1<-3.603074
alpha.enth.2<-96.979737
beta.enth.2<-143.682052
mix.2<-0.3426655
plot(x,mix.2*dbeta(x,alpha.enth.1,beta.enth.1)+(1-mix.2)*dbeta(x,alpha.enth.2,beta.enth.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Enthuastic Prior",
ylim=c(0,8))
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,8))
plot(x,mix.2*dbeta(x,alpha.enth.1,beta.enth.1)+(1-mix.2)*dbeta(x,alpha.enth.2,beta.enth.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Enthuastic Prior",
ylim=c(0,10))
## Design parameters, usual case ##
p.skpt<-0.20      # response rate for skeptic, enthusiast, futility
p.enth<-0.40
p.intr<-0.30
tail.skpt<-0.045  # tail probabilities for priors (low, high)
tail.enth<-0.05
sig.fut<-0.85     # significant trial result threshold
sig.eff<-0.95
cred.tail<-0.05   # credible interval is 1-cred.tail
max.ss<-76        # maximum sample size
# Step 1: Create grid for possible values of phi
phi.range<-seq(0,100,by=0.001)
# Step 2: Compute tail probabilities for every possible choice of phi
# upper tail probability equal to tail.skpt
quantiles.skpt<-qbeta(tail.skpt,(p.skpt)*phi.range,(1-(p.skpt))*phi.range,
lower.tail=FALSE)
# lower tail probability equal to tail.enth
quantiles.enth<-qbeta(tail.enth,(p.enth)*phi.range,(1-(p.enth))*phi.range,
lower.tail=TRUE)
# Step 3: Grid search to find value of phi with the desired tail probability for the priors
phi_L<-phi.range[which.min(abs(p.enth-quantiles.skpt))] # fixed 5/13/19
phi_H<-phi.range[which.min(abs(p.skpt-quantiles.enth))] # fixed 5/13/19
# Step 4: Find parameters for the priors
alpha.skpt<-(p.skpt)*phi_L
beta.skpt<-(1-(p.skpt))*phi_L
alpha.enth<-(p.enth)*phi_H
beta.enth<-(1-(p.enth))*phi_H
plot(x,mix.1*dbeta(x,alpha.skpt.1,beta.skpt.1)+(1-mix.1)*dbeta(x,alpha.skpt.2,beta.skpt.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Skeptical Prior",
ylim=c(0,8))
lines(x,dbeta(x,alpha.skpt,beta.skpt))
plot(x,mix.2*dbeta(x,alpha.enth.1,beta.enth.1)+(1-mix.2)*dbeta(x,alpha.enth.2,beta.enth.2),
type="l",xlab="Response Probability",ylab="Density Value",
main="Spike-Slab Enthuastic Prior",
ylim=c(0,10))
lines(x,dbeta(x,alpha.enth,beta.enth))
